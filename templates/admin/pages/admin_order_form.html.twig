{% extends "admin\\pages\\admin_orders.html.twig" %}

{% block body %}

{# buttons row #}
<div class="btn-row">
    <a href="#" class="btn" @click.prevent="orderForm.submit()">
        {% if editMode %}
        <svg xmlns="http://www.w3.org/2000/svg" height="1em"
            viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            <path
                d="M48 96V416c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V170.5c0-4.2-1.7-8.3-4.7-11.3l33.9-33.9c12 12 18.7 28.3 18.7 45.3V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96C0 60.7 28.7 32 64 32H309.5c17 0 33.3 6.7 45.3 18.7l74.5 74.5-33.9 33.9L320.8 84.7c-.3-.3-.5-.5-.8-.8V184c0 13.3-10.7 24-24 24H104c-13.3 0-24-10.7-24-24V80H64c-8.8 0-16 7.2-16 16zm80-16v80H272V80H128zm32 240a64 64 0 1 1 128 0 64 64 0 1 1 -128 0z" />
        </svg>
        Uložiť objednávku
        {% else %}
        <svg xmlns="http://www.w3.org/2000/svg" height="1em"
            viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            <path
                d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344V280H168c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H280v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z" />
        </svg>
        Vytvoriť a pridať produkt
        {% endif %}
    </a>

    {% if editMode %}
    {# pridat polozku #}
    <a href="{{ path('admin_orders_item_form', {orderPk: order.pk}) }}" class="btn">
        <svg xmlns="http://www.w3.org/2000/svg" height="1em"
            viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
            <path
                d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344V280H168c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H280v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z" />
        </svg>
        Pridať položku
    </a>

    {# spracovat stav #}
    {% if order.status < 4 %}
    <a href="{{ path('admin_orders_set_status') }}" id="order-form-set-status-btn" class="btn relative"
    x-data="{ statesDropdownOpen: false }" @click.outside="statesDropdownOpen = false" @click.prevent="orderForm.manageOrderStatus({{ order.nextstatus.pk.value }})">
        <svg xmlns="http://www.w3.org/2000/svg" height="1em"
            viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.-->
            <path
                d="M52.5 440.6c-9.5 7.9-22.8 9.7-34.1 4.4S0 428.4 0 416V96C0 83.6 7.2 72.3 18.4 67s24.5-3.6 34.1 4.4L224 214.3V256v41.7L52.5 440.6zM256 352V256 128 96c0-12.4 7.2-23.7 18.4-29s24.5-3.6 34.1 4.4l192 160c7.3 6.1 11.5 15.1 11.5 24.6s-4.2 18.5-11.5 24.6l-192 160c-9.5 7.9-22.8 9.7-34.1 4.4s-18.4-16.6-18.4-29V352z" />
        </svg>

        Spracovať stav
        
        {# <svg :class="statesDropdownOpen && 'rotate-180'" @click.prevent="statesDropdownOpen = ! statesDropdownOpen" class="hidden fill-current sm:block" width="12" height="8"
            viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd"
                d="M0.410765 0.910734C0.736202 0.585297 1.26384 0.585297 1.58928 0.910734L6.00002 5.32148L10.4108 0.910734C10.7362 0.585297 11.2638 0.585297 11.5893 0.910734C11.9147 1.23617 11.9147 1.76381 11.5893 2.08924L6.58928 7.08924C6.26384 7.41468 5.7362 7.41468 5.41077 7.08924L0.410765 2.08924C0.0853277 1.76381 0.0853277 1.23617 0.410765 0.910734Z"
                fill="" />
        </svg> #}

        {# todo - dorobit dropdown na spracovanie inych statvov #}
        <!-- states dropdown Start -->
        {# <div x-show="statesDropdownOpen"
            class="absolute right-0 mt-4 flex w-62.5 flex-col rounded-sm border border-stroke bg-white shadow-default">
            <ul class="flex flex-col gap-5 border-b border-stroke px-6 py-7.5">
                <li>1</li>
                <li>2</li>
                <li>3</li>
            </ul>
        </div> #}
    </a>
    {% endif %}
    {% endif %}
</div>

{# formular #}

<form action="{{ path('admin_orders_save') }}" data-redirect="{{ path('admin_orders_index') }}"
    data-item-form-url="{{ path('admin_orders_item_form') }}" id="order-form" class="form-wrapper"
    data-edit-mode="{{ editMode ? 1 : 0 }}" @submit.prevent="orderForm.submit()">
    <input type="hidden" name="pk" value="{{ order.pk }}" />

    <div class="md:form-horizontal-row">        
        {# zakaznik #}
        <div class="form-row">
            <label class="mb-3 block font-medium text-sm text-black">
                Zákazník
            </label>
            <div class="relative z-20 bg-white">
                <span class="absolute top-1/2 left-4 z-30 -translate-y-1/2">
                    <svg class="fill-current" width="18" height="18" viewBox="0 0 18 18" fill="none"
                        xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M9.0002 7.79065C11.0814 7.79065 12.7689 6.1594 12.7689 4.1344C12.7689 2.1094 11.0814 0.478149 9.0002 0.478149C6.91895 0.478149 5.23145 2.1094 5.23145 4.1344C5.23145 6.1594 6.91895 7.79065 9.0002 7.79065ZM9.0002 1.7719C10.3783 1.7719 11.5033 2.84065 11.5033 4.16252C11.5033 5.4844 10.3783 6.55315 9.0002 6.55315C7.62207 6.55315 6.49707 5.4844 6.49707 4.16252C6.49707 2.84065 7.62207 1.7719 9.0002 1.7719Z"
                            fill="" />
                        <path
                            d="M10.8283 9.05627H7.17207C4.16269 9.05627 1.71582 11.5313 1.71582 14.5406V16.875C1.71582 17.2125 1.99707 17.5219 2.3627 17.5219C2.72832 17.5219 3.00957 17.2407 3.00957 16.875V14.5406C3.00957 12.2344 4.89394 10.3219 7.22832 10.3219H10.8564C13.1627 10.3219 15.0752 12.2063 15.0752 14.5406V16.875C15.0752 17.2125 15.3564 17.5219 15.7221 17.5219C16.0877 17.5219 16.3689 17.2407 16.3689 16.875V14.5406C16.2846 11.5313 13.8377 9.05627 10.8283 9.05627Z"
                            fill="" />
                    </svg>
                </span>
                <select name="customerPk"
                    class="relative z-20 w-full appearance-none rounded border border-stroke bg-transparent py-3 px-12 outline-none transition focus:border-primary active:border-primary">
                    {% set selCustomerPk = order.customerPk %}
                    <option value="">Vyberte zákazníka</option>
                    {% for customer in customers %}
                    <option value="{{ customer.pk }}" {{ customer.pk==selCustomerPk ? "selected" }}>{{ customer.fullName }}
                    </option>
                    {% endfor %}
                </select>
                <span class="absolute top-1/2 right-4 z-10 -translate-y-1/2">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g opacity="0.8">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M5.29289 8.29289C5.68342 7.90237 6.31658 7.90237 6.70711 8.29289L12 13.5858L17.2929 8.29289C17.6834 7.90237 18.3166 7.90237 18.7071 8.29289C19.0976 8.68342 19.0976 9.31658 18.7071 9.70711L12.7071 15.7071C12.3166 16.0976 11.6834 16.0976 11.2929 15.7071L5.29289 9.70711C4.90237 9.31658 4.90237 8.68342 5.29289 8.29289Z"
                                fill="#637381"></path>
                        </g>
                    </svg>
                </span>
            </div>
        </div>

        {# admin #}
        <div class="form-row">
            <label class="mb-3 block font-medium text-sm text-black">
                Admin
            </label>
            <div class="relative z-20 bg-white">
                <span class="absolute top-1/2 left-4 z-30 -translate-y-1/2">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" width="18"
                        viewBox="0 0 576 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.-->
                        <path
                            d="M246.9 14.1C234 15.2 224 26 224 39c0 13.8 11.2 25 25 25H400c8.8 0 16-7.2 16-16V17.4C416 8 408 .7 398.7 1.4L246.9 14.1zM240 112c0 44.2 35.8 80 80 80s80-35.8 80-80c0-5.5-.6-10.8-1.6-16H241.6c-1 5.2-1.6 10.5-1.6 16zM72 224c-22.1 0-40 17.9-40 40s17.9 40 40 40H224v89.4L386.8 230.5c-13.3-4.3-27.3-6.5-41.6-6.5H240 72zm345.7 20.9L246.6 416H416V369.7l53.6 90.6c11.2 19 35.8 25.3 54.8 14.1s25.3-35.8 14.1-54.8L462.3 290.8c-11.2-18.9-26.6-34.5-44.6-45.9zM224 448v32c0 17.7 14.3 32 32 32H384c17.7 0 32-14.3 32-32V448H224z" />
                    </svg>
                </span>
                <select name="userPk"
                    class="relative z-20 w-full appearance-none rounded-lg border border-stroke bg-transparent py-3 px-12 outline-none transition focus:border-primary active:border-primary">
                    {% set loggedUserPk = user.pk %}
                    {% for user in users %}
                    <option value="{{ user.pk }}" {{ user.pk==loggedUserPk ? "selected" }}>{{ user.username }}</option>
                    {% endfor %}
                </select>
                <span class="absolute top-1/2 right-4 z-10 -translate-y-1/2">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g opacity="0.8">
                            <path fill-rule="evenodd" clip-rule="evenodd"
                                d="M5.29289 8.29289C5.68342 7.90237 6.31658 7.90237 6.70711 8.29289L12 13.5858L17.2929 8.29289C17.6834 7.90237 18.3166 7.90237 18.7071 8.29289C19.0976 8.68342 19.0976 9.31658 18.7071 9.70711L12.7071 15.7071C12.3166 16.0976 11.6834 16.0976 11.2929 15.7071L5.29289 9.70711C4.90237 9.31658 4.90237 8.68342 5.29289 8.29289Z"
                                fill="#637381"></path>
                        </g>
                    </svg>
                </span>
            </div>
        </div>
    </div>

    {# stav #}
    {% if editMode %}
    <div class="sm:form-horizontal-row">        
        <div class="form-row">
            <label>Stav</label>
            <input type="text" value="{{ order.actualstatus.title }}" disabled="">
        </div>

        <div class="form-row">
            <label class="empty">Stav</label>
            <input type="text" value="{{ order.actualstatusdate|date(" d.m.Y H:i:s") }}" disabled="">
        </div>
    </div>
    {% endif %}

    {# zaplatena suna #}
    {% if editMode %}
    <div class="form-row">
        <label>Zaplatená suma</label>
        <input type="text" name="realPrice" x-mask:dynamic="$money($input, '.', '', 2)"
            placeholder="Zadajte zaplatenú sumu za objednávku" value="{{ order.realprice }}">
    </div>

    {% endif %}

    {# polozky #}
    {% if order.orderitems|length > 0 %}
    <div class="form-row">
        <label>Položky</label>
        <div class="table-wrapper">
            <table id="table-order-items" data-form-url="{{ path('admin_orders_item_form', {orderPk: order.pk}) }}"
                data-delete-url="{{ path('admin_orders_item_delete') }}">
                <thead>
                    <tr class="text-left">
                        <th class="min-w-[220px]">
                            Produkt
                        </th>

                        <th class="min-w-[100px]">
                            Kusy
                        </th>

                        <th class="min-w-[120px]">
                            Cena/ks
                        </th>

                        <th class="min-w-[120px]">
                            Poznámka
                        </th>

                        <th></th>
                    </tr>
                </thead>

                <tbody>
                    {% for item in order.orderitems %}

                    <tr x-data="{ orderPk: {{ order.pk }}, itemPk: {{ item.pk }} }">
                        {# produkt #}
                        <td>
                            <h5 class="font-bold">{{ item.product.title }}</h5>
                            <small>{{ item.product.subtitle }}</small>
                        </td>

                        {# kusy #}
                        <td>
                            <p>{{ item.quantity }} ks</p>
                        </td>

                        {# cena/ks #}
                        <td>
                            <p>{{ item.price|number_format(2, ',', ' ') }} €</p>
                        </td>

                        {# poznamka #}
                        <td>
                            <p>{{ item.note }}</p>
                        </td>


                        {# actions #}
                        <td>
                            <div class="flex items-center space-x-3.5">
                                {# show button #}
                                <button class="hover:text-primary" x-on:click="orderItemEdit(itemPk)">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="fill-current" height="1em"
                                        viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                                        <path
                                            d="M410.3 231l11.3-11.3-33.9-33.9-62.1-62.1L291.7 89.8l-11.3 11.3-22.6 22.6L58.6 322.9c-10.4 10.4-18 23.3-22.2 37.4L1 480.7c-2.5 8.4-.2 17.5 6.1 23.7s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L387.7 253.7 410.3 231zM160 399.4l-9.1 22.7c-4 3.1-8.5 5.4-13.3 6.9L59.4 452l23-78.1c1.4-4.9 3.8-9.4 6.9-13.3l22.7-9.1v32c0 8.8 7.2 16 16 16h32zM362.7 18.7L348.3 33.2 325.7 55.8 314.3 67.1l33.9 33.9 62.1 62.1 33.9 33.9 11.3-11.3 22.6-22.6 14.5-14.5c25-25 25-65.5 0-90.5L453.3 18.7c-25-25-65.5-25-90.5 0zm-47.4 168l-144 144c-6.2 6.2-16.4 6.2-22.6 0s-6.2-16.4 0-22.6l144-144c6.2-6.2 16.4-6.2 22.6 0s6.2 16.4 0 22.6z" />
                                    </svg>
                                </button>

                                {# delete button #}
                                <button class="hover:text-primary" x-on:click="orderItemDelete(itemPk)">
                                    <svg class="fill-current" width="18" height="18" viewBox="0 0 18 18" fill="none"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path
                                            d="M13.7535 2.47502H11.5879V1.9969C11.5879 1.15315 10.9129 0.478149 10.0691 0.478149H7.90352C7.05977 0.478149 6.38477 1.15315 6.38477 1.9969V2.47502H4.21914C3.40352 2.47502 2.72852 3.15002 2.72852 3.96565V4.8094C2.72852 5.42815 3.09414 5.9344 3.62852 6.1594L4.07852 15.4688C4.13477 16.6219 5.09102 17.5219 6.24414 17.5219H11.7004C12.8535 17.5219 13.8098 16.6219 13.866 15.4688L14.3441 6.13127C14.8785 5.90627 15.2441 5.3719 15.2441 4.78127V3.93752C15.2441 3.15002 14.5691 2.47502 13.7535 2.47502ZM7.67852 1.9969C7.67852 1.85627 7.79102 1.74377 7.93164 1.74377H10.0973C10.2379 1.74377 10.3504 1.85627 10.3504 1.9969V2.47502H7.70664V1.9969H7.67852ZM4.02227 3.96565C4.02227 3.85315 4.10664 3.74065 4.24727 3.74065H13.7535C13.866 3.74065 13.9785 3.82502 13.9785 3.96565V4.8094C13.9785 4.9219 13.8941 5.0344 13.7535 5.0344H4.24727C4.13477 5.0344 4.02227 4.95002 4.02227 4.8094V3.96565ZM11.7285 16.2563H6.27227C5.79414 16.2563 5.40039 15.8906 5.37227 15.3844L4.95039 6.2719H13.0785L12.6566 15.3844C12.6004 15.8625 12.2066 16.2563 11.7285 16.2563Z"
                                            fill="" />
                                        <path
                                            d="M9.00039 9.11255C8.66289 9.11255 8.35352 9.3938 8.35352 9.75942V13.3313C8.35352 13.6688 8.63477 13.9782 9.00039 13.9782C9.33789 13.9782 9.64727 13.6969 9.64727 13.3313V9.75942C9.64727 9.3938 9.33789 9.11255 9.00039 9.11255Z"
                                            fill="" />
                                        <path
                                            d="M11.2502 9.67504C10.8846 9.64692 10.6033 9.90004 10.5752 10.2657L10.4064 12.7407C10.3783 13.0782 10.6314 13.3875 10.9971 13.4157C11.0252 13.4157 11.0252 13.4157 11.0533 13.4157C11.3908 13.4157 11.6721 13.1625 11.6721 12.825L11.8408 10.35C11.8408 9.98442 11.5877 9.70317 11.2502 9.67504Z"
                                            fill="" />
                                        <path
                                            d="M6.72245 9.67504C6.38495 9.70317 6.1037 10.0125 6.13182 10.35L6.3287 12.825C6.35683 13.1625 6.63808 13.4157 6.94745 13.4157C6.97558 13.4157 6.97558 13.4157 7.0037 13.4157C7.3412 13.3875 7.62245 13.0782 7.59433 12.7407L7.39745 10.2657C7.39745 9.90004 7.08808 9.64692 6.72245 9.67504Z"
                                            fill="" />
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>

                    {% endfor %}

                    {# sumar #}
                    <tr class="bg-gray-2">
                        <td>
                            <h5 class="font-bold">spolu</h5>
                        </td>

                        <td>
                            <p>{{ order.productsquantity }} ks</p>
                        </td>

                        <td>
                            <p>{{ order.totalprice|number_format(2, ',', ' ') }} €</p>
                        </td>

                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {# poznamka #}
    <div class="form-row last">
        <label>Poznámka</label>
        <textarea name="note" placeholder="Zadajte poznámku objednávku">{{ order.note }}</textarea>
    </div>

    {# aby sa formular dal submitnut eneterom #}
    <input type="submit" hidden />
</form>
{% endblock body %}